{"version":3,"sources":["../../src/utils/build.js"],"names":["program","bootstrap","graphqlRunner","copyStaticDirectory","activity","report","activityTimer","start","buildCSS","catch","reportFailure","err","end","buildProductionBundle","buildHTML","stripIndent","apiRunnerNode","graphql","html","require","formatStaticBuildError","msg","log","panic","name","module","exports"],"mappings":";;;;;;;;;;;wEAmBA,iBAAoBA,OAApB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACkCC,UAAUD,OAAV,CADlC;;AAAA;AAAA;AACUE,yBADV,SACUA,aADV;;AAEE;AACA;AACAC;;AAEIC,oBANN,GAMiBC,OAAOC,aAAP,CAAsB,gBAAtB,CANjB;;AAOEF,qBAASG,KAAT;AAPF;AAAA,mBAQQC,SAASR,OAAT,EAAkBS,KAAlB,CAAwB,eAAO;AACnCC,4BAAe,uBAAf,EAAuCC,GAAvC;AACD,aAFK,CARR;;AAAA;AAWEP,qBAASQ,GAAT;;AAEAR,uBAAWC,OAAOC,aAAP,CAAsB,gCAAtB,CAAX;AACAF,qBAASG,KAAT;AAdF;AAAA,mBAeQM,sBAAsBb,OAAtB,EAA+BS,KAA/B,CAAqC,eAAO;AAChDC,4BAAe,sBAAf,EAAsCC,GAAtC;AACD,aAFK,CAfR;;AAAA;AAkBEP,qBAASQ,GAAT;;AAEAR,uBAAWC,OAAOC,aAAP,CAAsB,kCAAtB,CAAX;AACAF,qBAASG,KAAT;AArBF;AAAA,mBAsBQO,UAAUd,OAAV,EAAmBS,KAAnB,CAAyB,eAAO;AACpCC,4BACEL,OAAOU,WAAY;;;;OADrB,EAMEJ,GANF;AAQD,aATK,CAtBR;;AAAA;AAgCEP,qBAASQ,GAAT;;AAhCF;AAAA,mBAkCQI,cAAe,aAAf,EAA6B,EAAEC,SAASf,aAAX,EAA7B,CAlCR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAegB,I;;;;;;;AAjBf,IAAMV,WAAWW,QAAS,aAAT,CAAjB;AACA,IAAML,YAAYK,QAAS,cAAT,CAAlB;AACA,IAAMN,wBAAwBM,QAAS,oBAAT,CAA9B;AACA,IAAMlB,YAAYkB,QAAS,cAAT,CAAlB;AACA,IAAMd,SAASc,QAAS,aAAT,CAAf;;eACmCA,QAAS,oBAAT,C;IAA3BC,sB,YAAAA,sB;;AACR,IAAMJ,gBAAgBG,QAAS,mBAAT,CAAtB;AACA,IAAMhB,sBAAsBgB,QAAS,yBAAT,CAA5B;;AAEA,SAAST,aAAT,CAAuBW,GAAvB,EAA4BV,GAA5B,EAAwC;AACtCN,SAAOiB,GAAP,CAAY,EAAZ;AACAjB,SAAOkB,KAAP,CACEF,GADF,EAEEV,IAAIa,IAAJ,KAAc,cAAd,GAA8Bb,GAA9B,GAAoCS,uBAAuBT,GAAvB,CAFtC;AAID;;AAuCDc,OAAOC,OAAP,GAAiBR,IAAjB","file":"build.js","sourcesContent":["/* @flow */\n\nconst buildCSS = require(`./build-css`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst report = require(`../reporter`)\nconst { formatStaticBuildError } = require(`../reporter/errors`)\nconst apiRunnerNode = require(`./api-runner-node`)\nconst copyStaticDirectory = require(`./copy-static-directory`)\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(\n    msg,\n    err.name !== `WebpackError` ? err : formatStaticBuildError(err)\n  )\n}\n\nasync function html(program: any) {\n  const { graphqlRunner } = await bootstrap(program)\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirectory()\n\n  let activity = report.activityTimer(`Generating CSS`)\n  activity.start()\n  await buildCSS(program).catch(err => {\n    reportFailure(`Generating CSS failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Compiling production bundle.js`)\n  activity.start()\n  await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JS failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Generating static HTML for pages`)\n  activity.start()\n  await buildHTML(program).catch(err => {\n    reportFailure(\n      report.stripIndent`\n        Generating static HTML for pages failed\n\n        See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n      `,\n      err\n    )\n  })\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, { graphql: graphqlRunner })\n}\n\nmodule.exports = html\n"]}